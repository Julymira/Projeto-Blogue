<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./assets/favicon.png" type="image/x-icon">
    <title>Meteora</title>

    <link rel="stylesheet" type="text/css" href="estilo.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

<nav class="navbar navbar-expand-md bg-black navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
            <h1 class="m-0"><img class="d-block" src="./assets/logo-meteora.png" alt="Logo da loja Meteora"></h1>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                </li>
            </ul>

        </div>
    </div>
</nav>

<h1 id="post-title"></h1>
<img id="post-image" src="" alt="Imagem do Post" />
<p id="post-text"></p>

<br>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('postId');

        if (postId) {
            fetchPostDetails(postId);
            fetchComments(postId);
        }
    });

    function fetchPostDetails(postId) {
        fetch(`http://localhost:8080/users/posts/${postId}`)
            .then(response => response.json())
            .then(post => {
                // Atualiza o conteúdo da página com as informações do post
                document.getElementById('post-title').innerText = post.title;
                document.getElementById('post-text').innerText = post.text;
                document.getElementById('post-image').src = post.imageUrl;
            })
            .catch(error => console.error('Erro ao buscar o post:', error));
    }

    function fetchComments(postId) {
    fetch(`http://localhost:8080/Comment/${postId}/comments`)
        .then(response => response.json())
        .then(comments => {
            const commentsList = document.getElementById('comments-list');
            commentsList.innerHTML = ''; // Limpa a lista antes de adicionar novos itens

            comments.forEach(comment => {
                const li = document.createElement('li');
                li.classList.add('comment-box');  // Adiciona classe para estilização
                li.innerHTML = `<strong>${comment.userName}</strong><br>${comment.comment_text}`;
                commentsList.appendChild(li);
            });
        })
        .catch(error => console.error('Erro ao buscar comentários:', error));
}
</script>

<form id="commentForm" enctype="multipart/form-data">

    <label for="content">Comente aqui:</label>
    <textarea id="content" name="content" rows="10" required></textarea>

    <input type="submit" value="Comentar">
</form>

<br><br>

<ul id="comments-list"></ul>

<!--
<div id="comments-section">
    <h2>Comentários</h2>
    <ul id="comments-list">
         Comentários serão inseridos aqui
    </ul>
</div>
-->
<br><br>

<footer class="text-center bg-black text-bg-dark">
    <p class="card-text py-3">2024 <i class="bi bi-c-circle"></i> Projeto fictício sem fins comerciais.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>